<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed A - Urban Engine</title>
    <style>
        /* ==========================================================================
        Urban Engine – Font Size Scale Reference (px-based)
        기준: Web(Desktop) px → 반응형 축소 매핑
        --------------------------------------------------------------------------
        Web px | Tablet px | Mobile px | Small Mobile px
        --------------------------------------------------------------------------
        44 | 38 | 32 | 26
        38 | 34 | 28 | 24
        28 | 26 | 24 | 20
        24 | 22 | 18 | 16
        22 | 20 | 16 | 14
        20 | 18 | 14 | 13
        18 | 16 | 14 | 13
        16 | 16 | 15 | 14
        15 | 15 | 14 | 13
        14 | 14 | 13 | 13
        13 | 13 | 13 | 13

        Usage rule:
        - Web px 값을 기준으로 선택
        - Tablet / Mobile / Small Mobile은 위 매핑을 그대로 적용
        - clamp(), media query, rem 변환의 기준 테이블로 사용
        ========================================================================== */

        @font-face {
            font-family: 'esamanruLight';
            src: url('Source/Fonts/esamanru Light.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'esamanruMedium';
            src: url('Source/Fonts/esamanru Medium.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --violet: #6f41b0;
            --gray: #808080;
            --light-gray: #b3b3b3;
            --black: #111111;
            --white: #f9f9f9;
            --orange: #f7931e;
            --bg: #f6f7f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'esamanruLight', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--black);
        }

        .page {
            max-width: 1080px;
            margin: 0 auto;
            padding: 50px 50px 80px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
        }

        .logo {
            font-family: 'esamanruMedium', sans-serif;
            font-size: 24px;
            color: var(--black);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .tab-group {
            display: flex;
            gap: 15px;
            margin: 120px 0 50px;
        }

        .tab {
            flex: 1;
            max-width: 150px;
            padding: 8px 24px;
            border-radius: 16px;
            font-size: 16px;
            font-family: 'esamanruMedium', sans-serif;
            background-color: var(--gray);
            color: var(--white);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .tab:active {
            transform: translateY(0);
        }

        .tab.active {
            background: linear-gradient(135deg, #8B5CF6 0%, #6f41b0 100%);
            box-shadow: 0 4px 12px rgba(111, 65, 176, 0.3);
        }

        .tab.active:hover {
            box-shadow: 0 6px 16px rgba(111, 65, 176, 0.4);
        }

        .section {
            padding: 6px 2px;
            margin-bottom: px;
        }

        .section-title {
            font-family: 'esamanruMedium', sans-serif;
            font-size: 28px;
            margin-top: 200px;
            margin-bottom: 14px;
        }

        .section-subtitle {
            color: var(--gray);
            font-size: 24px;
            margin-bottom: 12px;
        }

        .headline {
            font-family: 'esamanruMedium', sans-serif;
            font-size: 44px;
            margin-bottom: 22px;
        }

        .headline span {
            background: linear-gradient(135deg, #8B5CF6 0%, #6f41b0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bullet-list {
            list-style: none;
            display: grid;
            gap: 4px;
            color: var(--gray);
            font-size: 22px;
        }

        .bullet-list li {
            transition: all 0.3s ease;
            padding: 4px 0;
            cursor: default;
        }

        .bullet-list li:hover {
            transform: translateX(5px);
            color: var(--black);
        }

        .bullet-list li::before {
            content: "✓";
            color: var(--violet);
            margin-right: 8px;
            font-family: 'esamanruMedium', sans-serif;
            transition: all 0.3s ease;
        }

        .bullet-list li:hover::before {
            transform: scale(1.2);
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            margin-top: 16px;
        }

        .pattern-card {
            background: var(--white);
            border-radius: 40px;
            padding: 22px;
            border: 1px solid rgba(17, 17, 17, 0.06);
            text-align: center;
            min-height: 210px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .pattern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
        }

        .pattern-card:active {
            transform: translateY(-2px);
        }

        .pattern-card span {
            font-size: 28px;
            color: var(--gray);
        }

        .pattern-card strong {
            font-size: 38px;
            font-family: 'esamanruMedium', sans-serif;
            color: var(--violet);
        }

        .pattern-card strong.violet {
            color: var(--violet);
        }

        .pattern-card strong.gray {
            color: var(--gray);
        }

        .cta-chip {
            margin-top: 40px;
            width: 100%;
            background-color: #a5a5a5;
            color: var(--white);
            border-radius: 18px;
            padding: 10px 16px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .cta-chip:hover {
            background-color: #959595;
            transform: scale(1.02);
        }

        .cta-chip:active {
            transform: scale(0.98);
        }

        .ranking-title {
            font-family: 'esamanruMedium', sans-serif;
            font-size: 28px;
            margin-top: 200px;
            margin-bottom: 30px;
        }

        .ranking-item {
            display: grid;
            grid-template-columns: auto 1fr 300px;
            gap: 24px;
            align-items: start;
            margin-top: 0px;
        }

        .ranking-content {
            display: flex;
            flex-direction: column;
        }

        .ranking-item>.map-placeholder {
            align-self: stretch;
            height: auto;
            margin-top: 84px;
        }

        .ranking-card {
            background-color: var(--white);
            border-radius: 30px;
            padding: 30px 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(17, 17, 17, 0.06);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .ranking-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .ranking-label {
            font-family: 'esamanruMedium', sans-serif;
            color: var(--black);
            font-size: 24px;
            white-space: nowrap;

        }

        .ranking-header {
            margin-bottom: 14px;
        }

        .ranking-name {
            font-family: 'esamanruMedium', sans-serif;
            color: var(--violet);
            font-size: 24px;
            margin-bottom: 0px;
            transition: all 0.3s ease;
        }

        .ranking-desc {
            color: var(--gray);
            font-size: 16px;
            margin-bottom: 4px;
        }

        .metrics {
            display: flex;
            gap: 14px;
            margin: 24px 0 20px;
        }

        .metric-chip {
            background-color: #f4f5f7;
            color: var(--gray);
            border-radius: 28px;
            padding: 16px 22px;
            font-size: 16px;
            flex: 1;
            min-height: 150px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'esamanruMedium', sans-serif;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .metric-chip:hover {
            background-color: #eceef2;
            transform: scale(1.03);
        }

        .metric-chip strong {
            display: block;
            margin-top: 6px;
            font-family: 'esamanruMedium', sans-serif;
            color: var(--gray);
            font-size: 22px;
            transition: all 0.3s ease;
        }

        .metric-chip.orange {
            transition: all 0.3s ease;
        }

        .metric-chip.orange:hover {
            background: linear-gradient(135deg, rgba(247, 147, 30, 0.1) 0%, rgba(247, 147, 30, 0.05) 100%);
        }

        .metric-chip.orange strong {
            color: var(--orange);
        }

        .metric-chip.violet {
            transition: all 0.3s ease;
        }

        .metric-chip.violet:hover {
            background: linear-gradient(135deg, rgba(111, 65, 176, 0.1) 0%, rgba(111, 65, 176, 0.05) 100%);
        }

        .metric-chip.violet strong {
            color: var(--violet);
        }


        .cta-button {
            display: block;
            margin-top: 5px;
            background: linear-gradient(135deg, #8B5CF6 0%, #6f41b0 100%);
            color: var(--white);
            border-radius: 22px;
            padding: 12px 22px;
            font-size: 16px;
            font-family: 'esamanruMedium', sans-serif;
            text-decoration: none;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(111, 65, 176, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 65, 176, 0.4);
        }

        .cta-button:active {
            transform: translateY(0);
        }

        .map-placeholder {
            width: 100%;
            border-radius: 18px;
            background: #eef1f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light-gray);
            font-size: 12px;
        }

        .secondary-section {
            margin-bottom: 24px;
        }

        .secondary-header {
            font-family: 'esamanruMedium', sans-serif;
            font-size: 28px;
            margin-top: 160px;
            margin-bottom: 14px;
        }

        .secondary-sub {
            color: var(--light-gray);
            font-size: 24px;
            margin-bottom: 30px;
        }

        .bottom-banner {
            margin-top: 100px;
            background: linear-gradient(135deg, #8B5CF6 0%, #6f41b0 100%);
            color: var(--white);
            font-size: 24px;
            border-radius: 25px;
            padding: 0px 20px;
            text-align: center;
            font-family: 'esamanruMedium', sans-serif;
            line-height: 1.5;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 24px rgba(111, 65, 176, 0.3);
            transition: all 0.3s ease;
        }

        .bottom-banner:hover {
            box-shadow: 0 12px 32px rgba(111, 65, 176, 0.4);
            transform: translateY(-2px);
        }

        /* 태블릿 */
        @media (max-width: 960px) {
            .page {
                padding: 40px 30px 70px;
            }

            .logo {
                font-size: 22px;
            }

            .section-title,
            .ranking-title,
            .secondary-header {
                font-size: 26px;
                margin-top: 150px;
            }

            .section-subtitle,
            .secondary-sub {
                font-size: 22px;
            }

            .headline {
                font-size: 38px;
            }

            .bullet-list {
                font-size: 20px;
            }

            .pattern-card {
                min-height: 180px;
            }

            .pattern-card span {
                font-size: 24px;
            }

            .pattern-card strong {
                font-size: 34px;
            }

            .ranking-item {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .ranking-item>.map-placeholder {
                margin-top: 20px;
                height: 200px;
            }
        }

        /* 모바일 */
        @media (max-width: 768px) {
            .page {
                padding: 30px 20px 60px;
            }

            .logo {
                font-size: 20px;
            }

            .tab-group {
                gap: 10px;
                margin: 80px 0 40px;
            }

            .tab {
                padding: 10px 16px;
                font-size: 14px;
                border-radius: 12px;
                max-width: none;
            }

            .section-title,
            .ranking-title,
            .secondary-header {
                font-size: 24px;
                margin-top: 100px;
                margin-bottom: 12px;
            }

            .section-subtitle,
            .secondary-sub {
                font-size: 18px;
                margin-bottom: 10px;
            }

            .headline {
                font-size: 32px;
                margin-bottom: 18px;
            }

            .bullet-list {
                font-size: 16px;
                gap: 6px;
            }

            .pattern-grid {
                grid-template-columns: 1fr;
                gap: 14px;
                margin-top: 14px;
            }

            .pattern-card {
                border-radius: 28px;
                padding: 20px;
                min-height: 140px;
                gap: 14px;
            }

            .pattern-card span {
                font-size: 18px;
            }

            .pattern-card strong {
                font-size: 28px;
            }

            .cta-chip {
                margin-top: 30px;
                font-size: 14px;
                padding: 12px 14px;
                border-radius: 14px;
            }

            .ranking-item {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .ranking-card {
                border-radius: 24px;
                padding: 24px 20px;
                margin-bottom: 20px;
            }

            .ranking-label {
                font-size: 20px;
            }

            .ranking-name {
                font-size: 20px;
            }

            .ranking-desc {
                font-size: 14px;
            }

            .metrics {
                flex-direction: column;
                gap: 10px;
                margin: 18px 0 16px;
            }

            .metric-chip {
                padding: 14px 18px;
                font-size: 14px;
                min-height: auto;
                border-radius: 18px;
            }

            .metric-chip strong {
                margin-top: 4px;
                font-size: 18px;
            }

            .cta-button {
                padding: 14px 20px;
                font-size: 15px;
                border-radius: 18px;
            }

            .ranking-item>.map-placeholder {
                margin-top: 0;
                height: 180px;
            }

            .bottom-banner {
                margin-top: 80px;
                font-size: 18px;
                border-radius: 20px;
                padding: 30px 20px;
                min-height: 160px;
            }
        }

        /* 작은 모바일 */
        @media (max-width: 480px) {
            .page {
                padding: 20px 16px 50px;
            }

            .logo {
                font-size: 18px;
            }

            .tab-group {
                gap: 8px;
                margin: 60px 0 30px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 13px;
                border-radius: 10px;
            }

            .section-title,
            .ranking-title,
            .secondary-header {
                font-size: 20px;
                margin-top: 80px;
                margin-bottom: 10px;
            }

            .section-subtitle,
            .secondary-sub {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .headline {
                font-size: 26px;
                margin-bottom: 14px;
            }

            .bullet-list {
                font-size: 14px;
                gap: 4px;
            }

            .pattern-grid {
                gap: 12px;
                margin-top: 12px;
            }

            .pattern-card {
                border-radius: 20px;
                padding: 16px;
                min-height: 120px;
                gap: 10px;
            }

            .pattern-card span {
                font-size: 16px;
            }

            .pattern-card strong {
                font-size: 24px;
            }

            .cta-chip {
                margin-top: 24px;
                font-size: 13px;
                padding: 10px 12px;
                border-radius: 12px;
            }

            .ranking-card {
                border-radius: 20px;
                padding: 20px 16px;
                margin-bottom: 16px;
            }

            .ranking-label {
                font-size: 18px;
            }

            .ranking-name {
                font-size: 18px;
            }

            .ranking-desc {
                font-size: 13px;
            }

            .metrics {
                gap: 8px;
                margin: 14px 0 14px;
            }

            .metric-chip {
                padding: 12px 16px;
                font-size: 13px;
                border-radius: 16px;
            }

            .metric-chip strong {
                margin-top: 3px;
                font-size: 16px;
            }

            .cta-button {
                padding: 12px 18px;
                font-size: 14px;
                border-radius: 16px;
            }

            .ranking-item>.map-placeholder {
                height: 150px;
                border-radius: 14px;
            }

            .map-placeholder {
                border-radius: 14px;
            }

            .bottom-banner {
                margin-top: 60px;
                font-size: 16px;
                border-radius: 18px;
                padding: 25px 16px;
                min-height: 140px;
                line-height: 1.6;
            }
        }
    </style>
</head>

<body>
    <div class="page">
        <header>
            <div class="logo">Urban Engine</div>
        </header>

        <div class="tab-group">
            <div class="tab active">매매</div>
            <div class="tab">전세</div>
            <div class="tab">월세</div>
        </div>

        <section class="section">
            <div class="section-subtitle">당신의 주거 선택 선호도는?</div>
            <div class="headline" id="personaHeadline">역 가까운 게 우선</div>
            <ul class="bullet-list" id="personaBulletList">
                <li>출퇴근이랑 이동 시간 줄이는 게 중요함</li>
                <li>집은 좀 커야 할 것 같은데, 고민중</li>
            </ul>
        </section>

        <section class="section">
            <div class="section-title">당신의 주거 선택 패턴은?</div>
            <div class="pattern-grid" id="personaPatternGrid">
                <div class="pattern-card">
                    <span>지하철역 거리</span>
                    <strong class="violet">가까움</strong>
                </div>
                <div class="pattern-card">
                    <span>집값</span>
                    <strong class="gray">비싸도 OK</strong>
                </div>
                <div class="pattern-card">
                    <span>집 크기</span>
                    <strong class="violet">커야함</strong>
                </div>
                <div class="pattern-card">
                    <span>공원과의 거리</span>
                    <strong class="gray">상관 없음</strong>
                </div>
            </div>
            <div class="cta-chip">더 많은 기준을 보고싶다면?</div>
        </section>

        <section class="section">
            <div class="ranking-title">서울에서 추천하는 지역 TOP3</div>
            <div id="top3DistrictList">
                <div class="ranking-card">
                    <div class="ranking-item">
                        <span class="ranking-label">TOP 1</span>
                        <div>
                            <div class="ranking-header">
                                <span class="ranking-name">11215710_010</span>
                            </div>
                            <div class="ranking-desc">추천 구역 ID</div>
                            <div class="metrics">
                                <div class="metric-chip violet">지하철역 접근성<strong>최고</strong></div>
                                <div class="metric-chip">주민 노후도<strong>적정</strong></div>
                                <div class="metric-chip orange">주택 가격<strong>다소 비쌈</strong></div>
                            </div>
                            <a href="#" class="cta-button">영상으로 살펴보기</a>
                        </div>
                        <div class="map-placeholder">MAP PREVIEW</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="secondary-section">
            <div class="secondary-header">지역 이동이 가능하시다면..?</div>
            <div class="secondary-sub">다음 지역도 검토해보세요!</div>
            <div id="secondaryDistrictList">
                <div class="ranking-card">
                    <div class="ranking-item">
                        <span class="ranking-label">근거리</span>
                        <div>
                            <div class="ranking-header">
                                <span class="ranking-name">11215710_021</span>
                            </div>
                            <div class="ranking-desc">추천 구역 ID</div>
                            <div class="metrics">
                                <div class="metric-chip violet">지하철역 접근성<strong>최고</strong></div>
                                <div class="metric-chip">주민 노후도<strong>적정</strong></div>
                                <div class="metric-chip orange">주택 가격<strong>다소 비쌈</strong></div>
                            </div>
                            <a href="#" class="cta-button">영상으로 살펴보기</a>
                        </div>
                        <div class="map-placeholder">MAP PREVIEW</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="bottom-banner">
            궁금한 지역은 영상으로 살펴보기를 눌러보세요!<br>
            선호에 맞는 맞춤형 피드를 보여드려요.
        </div>
    </div>

    <script>
        // URL 파라미터에서 personaId 가져오기
        function getPersonaIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('personaId') || 'P01'; // 디폴트값: P01
        }

        function parseCsv(text) {
            const lines = text.trim().split(/\r?\n/);
            const headers = lines.shift().split(',').map(header => header.replace(/^\uFEFF/, '').trim());
            return lines.map(line => {
                const values = line.split(',');
                return headers.reduce((acc, header, index) => {
                    acc[header] = values[index] ? values[index].trim() : '';
                    return acc;
                }, {});
            });
        }

        async function loadPersonaPreferenceCards(personaId) {
            try {
                const [cardResponse, csvResponse] = await Promise.all([
                    fetch('Source/Feed_A_Persona_Pref_Card.json'),
                    fetch('Source/Persona_1.csv')
                ]);

                if (!cardResponse.ok || !csvResponse.ok) {
                    throw new Error('Failed to load preference data');
                }

                const prefCardData = await cardResponse.json();
                const csvText = await csvResponse.text();
                const rows = parseCsv(csvText)
                    .filter(row => row.persona_id === personaId)
                    .filter(row => prefCardData[row.preference_key]);

                const sortedRows = rows
                    .map(row => ({
                        ...row,
                        priority: Number.isNaN(parseInt(row.priority, 10)) ? 0 : parseInt(row.priority, 10)
                    }))
                    .sort((a, b) => b.priority - a.priority);

                const topRows = sortedRows.slice(0, 4);
                const patternGrid = document.getElementById('personaPatternGrid');
                if (!patternGrid || topRows.length === 0) {
                    return;
                }

                patternGrid.innerHTML = '';
                topRows.forEach(row => {
                    const cardConfig = prefCardData[row.preference_key];
                    const card = document.createElement('div');
                    card.className = 'pattern-card';

                    const label = document.createElement('span');
                    label.textContent = cardConfig.label;

                    const value = document.createElement('strong');
                    const directionMap = cardConfig.direction_map || cardConfig.directionMap || {};
                    const mappedDirection = directionMap[row.direction];
                    const mappedText = typeof mappedDirection === 'object' && mappedDirection !== null
                        ? mappedDirection.text || mappedDirection.label || mappedDirection.value
                        : mappedDirection;
                    value.textContent = mappedText || row.direction;

                    const directionTagMap = cardConfig.tag_map || cardConfig.tagMap || {};
                    const tagMapping = cardConfig.tagging || cardConfig.tagging_map || {};
                    const colorMap = cardConfig.color_map || cardConfig.colorMap || cardConfig.color || {};
                    const tagColorMap = cardConfig.tag_color_map || cardConfig.tagColorMap || {};

                    let resolvedTag = directionTagMap[row.direction];
                    if (!resolvedTag && typeof mappedDirection === 'object' && mappedDirection !== null) {
                        resolvedTag = mappedDirection.tag || mappedDirection.sentiment || mappedDirection.type;
                    }
                    if (!resolvedTag) {
                        const positiveTags = tagMapping.positive || tagMapping.긍정 || [];
                        const neutralTags = tagMapping.neutral || tagMapping.중립 || [];
                        if (Array.isArray(positiveTags) && positiveTags.includes(row.direction)) {
                            resolvedTag = 'positive';
                        } else if (Array.isArray(neutralTags) && neutralTags.includes(row.direction)) {
                            resolvedTag = 'neutral';
                        }
                    }

                    const configuredColor = colorMap[row.direction]
                        || (resolvedTag ? colorMap[resolvedTag] || tagColorMap[resolvedTag] : undefined)
                        || colorMap.default
                        || tagColorMap.default;

                    if (configuredColor) {
                        value.style.color = configuredColor;
                    } else {
                        value.className = row.direction === '상관없음' ? 'gray' : 'violet';
                    }

                    card.appendChild(label);
                    card.appendChild(value);
                    patternGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading preference cards:', error);
            }
        }

        function createDistrictCard({ label, distId }) {
            const card = document.createElement('div');
            card.className = 'ranking-card';

            card.innerHTML = `
                <div class="ranking-item">
                    <span class="ranking-label">${label}</span>
                    <div>
                        <div class="ranking-header">
                            <span class="ranking-name">${distId}</span>
                        </div>
                        <div class="ranking-desc">추천 구역 ID</div>
                        <div class="metrics">
                            <div class="metric-chip violet">지하철역 접근성<strong>최고</strong></div>
                            <div class="metric-chip">주민 노후도<strong>적정</strong></div>
                            <div class="metric-chip orange">주택 가격<strong>다소 비쌈</strong></div>
                        </div>
                        <a href="#" class="cta-button">영상으로 살펴보기</a>
                    </div>
                    <div class="map-placeholder">MAP PREVIEW</div>
                </div>
            `;

            return card;
        }

        async function loadRecommendDistricts(personaId) {
            try {
                const response = await fetch('Data/L2.A/A_recommend_district.json');
                if (!response.ok) {
                    throw new Error('Failed to load district data');
                }

                const districtData = await response.json();
                const personaDistricts = districtData.filter(entry => entry.persona_id === personaId);
                if (personaDistricts.length === 0) {
                    return;
                }

                const top3Container = document.getElementById('top3DistrictList');
                const secondaryContainer = document.getElementById('secondaryDistrictList');

                if (top3Container) {
                    top3Container.innerHTML = '';
                    personaDistricts.slice(0, 3).forEach((entry, index) => {
                        top3Container.appendChild(
                            createDistrictCard({ label: `TOP ${index + 1}`, distId: entry.dist_id })
                        );
                    });
                }

                if (secondaryContainer) {
                    secondaryContainer.innerHTML = '';
                    personaDistricts.slice(3, 5).forEach(entry => {
                        secondaryContainer.appendChild(
                            createDistrictCard({ label: '근거리', distId: entry.dist_id })
                        );
                    });
                }
            } catch (error) {
                console.error('Error loading district data:', error);
            }
        }

        // 페르소나 데이터 로드 및 적용
        async function loadPersonaData() {
            try {
                const personaId = getPersonaIdFromUrl();
                console.log('Loading persona:', personaId);

                // JSON 파일 로드
                const response = await fetch('Source/Feed_A_Persona_Pref.json');
                if (!response.ok) {
                    throw new Error('Failed to load persona data');
                }

                const personaData = await response.json();

                // 해당 페르소나 찾기
                const selectedPersona = personaData.find(p => p.persona_id === personaId);

                if (selectedPersona) {
                    // headline 업데이트
                    const headlineElement = document.getElementById('personaHeadline');
                    if (headlineElement) {
                        headlineElement.textContent = selectedPersona.headline;
                    }

                    // bullet-list 업데이트
                    const bulletListElement = document.getElementById('personaBulletList');
                    if (bulletListElement && selectedPersona.checks) {
                        bulletListElement.innerHTML = '';
                        selectedPersona.checks.forEach(check => {
                            const li = document.createElement('li');
                            li.textContent = check;
                            bulletListElement.appendChild(li);
                        });
                    }

                    await loadPersonaPreferenceCards(personaId);
                    await loadRecommendDistricts(personaId);

                    console.log('Persona loaded successfully:', selectedPersona.persona_name);
                } else {
                    console.warn('Persona not found:', personaId);
                }
            } catch (error) {
                console.error('Error loading persona data:', error);
                // 에러 발생 시 디폴트 콘텐츠 유지
            }
        }

        // 페이지 로드 시 실행
        window.addEventListener('DOMContentLoaded', loadPersonaData);
    </script>
</body>

</html>
